# -*- coding: utf-8 -*-
"""gastos evidencia1.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1V2TANyO4ahLOourA-o--7XuyOuXiDEgw
"""
#python -m streamlit run
import pandas as pd
from pandas import Series, DataFrame
import seaborn as sns
import numpy as np
from datetime import date, time, datetime, timedelta
import altair as alt
import streamlit as st
from PIL import Image
import matplotlib.pyplot as plt
import streamlit_extras
from streamlit_extras.metric_cards import style_metric_cards
from streamlit_extras.colored_header import colored_header
from streamlit_extras.stoggle import stoggle



#cd D:\OneDrive\Documentos\CalorControl\Dashboard
#python -m streamlit run "D:\OneDrive\Documentos\CalorControl\Dashboard\evidencia3_SYNTAXERROR.py"


st.set_page_config(page_title = 'Calor y Control',
page_icon =':chart_with_upwards_trend:',
layout = 'wide')

logo  = Image.open('logo.png')
#st.title(':red[Reporte de Control Operativo]' and st.image(logo, width=None))

col1, col2 = st.columns(2)
with col1:
    st.title('Reporte de Control Operativo')
with col2:
   st.image(logo, width=300)
    

clientes = pd.read_excel('clientes_clean.xlsx', index_col=0)
devoluciones = pd.read_excel('devoluciones_clean.xlsx', index_col=0)
facturacion = pd.read_excel('facturacion_clean.xlsx', index_col=0)
notas_credito = pd.read_excel('notas_credito_clean.xlsx', index_col=0)
precios = pd.read_excel('precios_productos_clean.xlsx', index_col=0)
saldos = pd.read_excel('saldos_clean_pt2.xlsx', index_col=0)
gastos_20 = pd.read_excel('gastos_c2020_clean.xlsx', index_col=0)
gastos_21 = pd.read_excel('gastos_c2021_clean.xlsx', index_col=0)
gastos_22 = pd.read_excel('gastos_c2022_clean.xlsx', index_col=0)
gastos_23 = pd.read_excel('gastos_c2023_clean.xlsx', index_col=0)
productos = pd.read_excel('precios_productos.xlsx', index_col=0)

facturacion['MES']=facturacion['FECHA_VEN'].dt.month
facturacion['AÑO']=facturacion['FECHA_VEN'].dt.year
devoluciones['MES']=devoluciones['FECHA_VEN'].dt.month
devoluciones['AÑO']=devoluciones['FECHA_VEN'].dt.year
notas_credito['MES']=notas_credito['FECHA_VEN'].dt.month
notas_credito['AÑO']=notas_credito['FECHA_VEN'].dt.year
productos['MES']=productos['FECHA_DOC'].dt.month
gastos_23['MES']=gastos_23['FECHA'].dt.month
gastos_23['AÑO']=gastos_23['FECHA'].dt.year
gastos_22['MES']=gastos_22['FECHA'].dt.month
gastos_22['AÑO']=gastos_22['FECHA'].dt.year
gastos_21['MES']=gastos_21['FECHA'].dt.month
gastos_21['AÑO']=gastos_21['FECHA'].dt.year
gastos_20['MES']=gastos_20['FECHA'].dt.month
gastos_20['AÑO']=gastos_20['FECHA'].dt.year

Calor =['#ff6c3e','#ba1424','#8A0E1A','#746c6c', '#444441','a52712'] 
coloraños=['#7A5C3C','#005187','#C25E00','#BA1424']

clientes2=pd.DataFrame()
clientes2 = clientes.drop(['CLAVE'], axis=1)
facturacion= pd.merge(clientes2, facturacion, on='RFC', how='right')
facturacion2=facturacion[facturacion["DES_TOT"] > 0]
facturacion3=pd.DataFrame()
facturacion3 = facturacion2.drop(['FECHA_DOC', 'FECHA_VEN', 'FECHA_CANCELA'], axis=1)
facturacion3=facturacion3.fillna({'NOMBRE':'NO COINCIDENCIAS'})

notas_credito = pd.merge(clientes2, notas_credito, on='RFC', how='right')
notas_credito2=pd.DataFrame()
notas_credito2 = notas_credito.drop(['FECHA_DOC', 'FECHA_VEN', 'FECHA_CANCELA'], axis=1)
notas_credito2=notas_credito2.fillna({'NOMBRE':'NO COINCIDENCIAS'})

devoluciones = pd.merge(clientes2, devoluciones, on='RFC', how='right')
devoluciones2=pd.DataFrame()
devoluciones2 = devoluciones.drop(['FECHA_DOC', 'FECHA_VEN', 'FECHA_CANCELA'], axis=1)
devoluciones2=devoluciones2.fillna({'NOMBRE':'NO COINCIDENCIAS'})

prueba20=pd.DataFrame()
prueba20['IMPORTE TOTAL']=gastos_20.groupby('TIPO GASTO')['IMPORTE'].sum()
prueba20=prueba20.reset_index()

prueba21=pd.DataFrame()
prueba21['IMPORTE TOTAL']=gastos_21.groupby('TIPO GASTO')['IMPORTE'].sum()
prueba21=prueba21.reset_index()

prueba22=pd.DataFrame()
prueba22['IMPORTE TOTAL']=gastos_22.groupby('TIPO GASTO')['Importe'].sum()
prueba22=prueba22.reset_index()

prueba23=pd.DataFrame()
prueba23['IMPORTE TOTAL']=gastos_23.groupby('TIPO GASTO')['Importe'].sum()
prueba23=prueba23.reset_index()

prueba20['GASTO']= prueba20['TIPO GASTO']
prueba20['GASTO']=np.where(prueba20['GASTO']=='COMISION BANCARIA', 'GASTOS FINANCIEROS',
                     np.where(prueba20['GASTO']== 'PAPELERIA','GASTOS ADMINISTRATIVOS',
                              np.where(prueba20['GASTO']== 'CAPACITACION', 'GASTOS ADMINISTRATIVOS',
                                       np.where(prueba20['GASTO'] == 'ARRENDAMIENTO FINANCIERO', 'GASTOS FINANCIEROS',
                                                np.where(prueba20['GASTO']== 'CALIBRACIONES', 'COSTO',
                                                         np.where(prueba20['GASTO'] == 'COMBUSTIBLE', 'GASTO DE VENTAS',
                                                                  np.where(prueba20['GASTO']== 'COMBUSTIBLE','GASTO DE VENTAS',
                                                                           np.where(prueba20['GASTO']==  'COMISION VENTA', 'GASTO DE VENTAS',
                                                                                  np.where(prueba20['GASTO'] == 'COMPRAS', 'OTROS',
                                                                                           np.where(prueba20['GASTO']== 'DERECHOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                    np.where(prueba20['GASTO']== 'ENERGIA ELECTRICA', 'COSTO',
                                                                                                             np.where(prueba20['GASTO']== 'GERENCIA VTAS', 'GASTO DE VENTAS',
                                                                                                                      np.where(prueba20['GASTO']== 'HONORARIOS ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                               np.where(prueba20['GASTO']== 'HONORARIOS CONTABLES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                        np.where(prueba20['GASTO']== 'HOSPEDAJE', 'GASTO DE VENTAS', 
                                                                                                                                                 np.where(prueba20['GASTO']== 'IMSS/INFONAVIT', 'OTROS',
                                                                                                                                                          np.where(prueba20['GASTO']== 'MAQUILAS GIC', 'COSTO',
                                                                                                                                                                   np.where(prueba20['GASTO']== 'MAQUINARIA', 'COSTO',
                                                                                                                                                                            np.where(prueba20['GASTO']== 'MTTO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                     np.where(prueba20['GASTO']== 'MTTO LOCAL', 'COSTO',
                                                                                                                                                                                              np.where(prueba20['GASTO']== 'NO DEDUCIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                       np.where(prueba20['GASTO'] == 'PAPELERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                np.where(prueba20['GASTO'] == 'PAQUETERIA', 'COSTO',
                                                                                                                                                                                                                         np.where(prueba20['GASTO'] == 'PEAJES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                  np.where(prueba20['GASTO'] == 'REPARACIONES ELECTRICAS', 'COSTO',
                                                                                                                                                                                                                                           np.where(prueba20['GASTO'] == 'SEGUROS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                    np.where(prueba20['GASTO'] == 'TELEFONO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                             np.where(prueba20['GASTO'] == 'TRANSPORTE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                      np.where(prueba20['GASTO'] == 'UNIFORME', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                               np.where(prueba20['GASTO'] == 'VALES DESPENSA', 'OTROS',
                                                                                                                                                                                                                                                                                        np.where(prueba20['GASTO'] == 'ALIMENTOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                 np.where(prueba20['GASTO'] == 'ARRENDAMIENTO LOCAL', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                          np.where(prueba20['GASTO'] == 'GERENCIA ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                   np.where(prueba20['GASTO'] == 'MOBILIARIO', 'GASTOS ADMINISTRATIVOS', 
                                                                                                                                                                                                                                                                                                                            np.where(prueba20['GASTO'] == 'SUSCRIPCIONES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                     np.where(prueba20['GASTO'] == 'MTTO TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                              np.where(prueba20['GASTO'] == 'SUBCONTRATOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                       np.where(prueba20['GASTO'] == 'MEDICOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                np.where(prueba20['GASTO'] == 'PUBLICIDAD', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                         np.where(prueba20['GASTO'] == 'FLETES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba20['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba20['GASTO'] == 'MENSAJERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba20['GASTO'] == 'ATENCION CLIENTES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba20['GASTO'] == 'SERV FUNERARIO ', 'GASTOS ADMINISTRATIVOS', 'OTROS'
                                                                                                                                                                                                                                                                                                                                                                                                                                        ))))))))))))))))))))))))))))))))))))))))))))

prueba21['GASTO']= prueba21['TIPO GASTO']
prueba21['GASTO']=np.where(prueba21['GASTO']=='COMISION BANCARIA', 'GASTOS FINANCIEROS',
                     np.where(prueba21['GASTO']== 'PAPELERIA','GASTOS ADMINISTRATIVOS',
                              np.where(prueba21['GASTO']== 'CAPACITACION', 'GASTOS ADMINISTRATIVOS',
                                       np.where(prueba21['GASTO'] == 'ARRENDAMIENTO FINANCIERO', 'GASTOS FINANCIEROS',
                                                np.where(prueba21['GASTO']== 'CALIBRACIONES', 'COSTO',
                                                         np.where(prueba21['GASTO'] == 'COMBUSTIBLE', 'GASTO DE VENTAS',
                                                                  np.where(prueba21['GASTO']== 'COMBUSTIBLE','GASTO DE VENTAS',
                                                                           np.where(prueba21['GASTO']==  'COMISION VENTA', 'GASTO DE VENTAS',
                                                                                  np.where(prueba21['GASTO'] == 'COMPRAS', 'OTROS',
                                                                                           np.where(prueba21['GASTO']== 'DERECHOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                    np.where(prueba21['GASTO']== 'ENERGIA ELECTRICA', 'COSTO',
                                                                                                             np.where(prueba21['GASTO']== 'GERENCIA VTAS', 'GASTO DE VENTAS',
                                                                                                                      np.where(prueba21['GASTO']== 'HONORARIOS ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                               np.where(prueba21['GASTO']== 'HONORARIOS CONTABLES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                        np.where(prueba21['GASTO']== 'HOSPEDAJE', 'GASTO DE VENTAS', 
                                                                                                                                                 np.where(prueba21['GASTO']== 'IMSS/INFONAVIT', 'OTROS',
                                                                                                                                                          np.where(prueba21['GASTO']== 'MAQUILAS GIC', 'COSTO',
                                                                                                                                                                   np.where(prueba21['GASTO']== 'MAQUINARIA', 'COSTO',
                                                                                                                                                                            np.where(prueba21['GASTO']== 'MTTO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                     np.where(prueba21['GASTO']== 'MTTO LOCAL', 'COSTO',
                                                                                                                                                                                              np.where(prueba21['GASTO']== 'NO DEDUCIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                       np.where(prueba21['GASTO'] == 'PAPELERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                np.where(prueba21['GASTO'] == 'PAQUETERIA', 'COSTO',
                                                                                                                                                                                                                         np.where(prueba21['GASTO'] == 'PEAJES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                  np.where(prueba21['GASTO'] == 'REPARACIONES ELECTRICAS', 'COSTO',
                                                                                                                                                                                                                                           np.where(prueba21['GASTO'] == 'SEGUROS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                    np.where(prueba21['GASTO'] == 'TELEFONO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                             np.where(prueba21['GASTO'] == 'TRANSPORTE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                      np.where(prueba21['GASTO'] == 'UNIFORME', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                               np.where(prueba21['GASTO'] == 'VALES DESPENSA', 'OTROS',
                                                                                                                                                                                                                                                                                        np.where(prueba21['GASTO'] == 'ALIMENTOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                 np.where(prueba21['GASTO'] == 'ARRENDAMIENTO LOCAL', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                          np.where(prueba21['GASTO'] == 'GERENCIA ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                   np.where(prueba21['GASTO'] == 'MOBILIARIO', 'GASTOS ADMINISTRATIVOS', 
                                                                                                                                                                                                                                                                                                                            np.where(prueba21['GASTO'] == 'SUSCRIPCIONES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                     np.where(prueba21['GASTO'] == 'MTTO TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                              np.where(prueba21['GASTO'] == 'SUBCONTRATOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                       np.where(prueba21['GASTO'] == 'MEDICOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                np.where(prueba21['GASTO'] == 'PUBLICIDAD', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                         np.where(prueba21['GASTO'] == 'FLETES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba21['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba21['GASTO'] == 'MENSAJERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba21['GASTO'] == 'ATENCION CLIENTES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba21['GASTO'] == 'SERV FUNERARIO ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                      np.where(prueba21['GASTO'] == 'SUELDOS DIRECCION', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                        np.where(prueba21['GASTO'] == 'SUELDOS PRODUCCION', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                 np.where(prueba21['GASTO'] == 'SUELDOS VENTAS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                          np.where(prueba21['GASTO'] == 'COMPRA COMPUTADORA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba21['GASTO'] == 'COMPRA TABLET ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba21['GASTO'] == 'FLETE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba21['GASTO'] == 'GASOLINA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba21['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      np.where(prueba21['GASTO'] == 'GASTOS IMPORTACION ', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               np.where(prueba21['GASTO'] == 'HONORARIOS JURIDICOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        np.where(prueba21['GASTO'] == 'MTTO OFICINA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 np.where(prueba21['GASTO'] == 'HONORARIOS PF', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          np.where(prueba21['GASTO'] == 'MAQUILAS', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   np.where(prueba21['GASTO'] == 'MONITOREO CAMARAS ADT', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            np.where(prueba21['GASTO'] == 'RENTA COPIADORA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     np.where(prueba21['GASTO'] == 'RENTA OFICINA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              np.where(prueba21['GASTO'] == 'SANITIZACION', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       np.where(prueba21['GASTO'] == 'MTTO MAQUINARIA', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       np.where(prueba21['GASTO'] == 'HOSPEDAJE ', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                np.where(prueba21['GASTO'] == 'COMBUSTIBLE ', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         np.where(prueba21['GASTO'] == 'BOTIQUIN', 'GASTOS ADMINISTRATIVOS', 'OTROS'
                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                        )))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))

prueba22['GASTO']= prueba22['TIPO GASTO']
prueba22['GASTO']=np.where(prueba22['GASTO']=='COMISION BANCARIA', 'GASTOS FINANCIEROS',
                     np.where(prueba22['GASTO']== 'PAPELERIA','GASTOS ADMINISTRATIVOS',
                              np.where(prueba22['GASTO']== 'CAPACITACION', 'GASTOS ADMINISTRATIVOS',
                                       np.where(prueba22['GASTO'] == 'ARRENDAMIENTO FINANCIERO', 'GASTOS FINANCIEROS',
                                                np.where(prueba22['GASTO']== 'CALIBRACIONES', 'COSTO',
                                                         np.where(prueba22['GASTO'] == 'COMBUSTIBLE', 'GASTO DE VENTAS',
                                                                  np.where(prueba22['GASTO']== 'COMBUSTIBLE','GASTO DE VENTAS',
                                                                           np.where(prueba22['GASTO']==  'COMISION VENTA', 'GASTO DE VENTAS',
                                                                                  np.where(prueba22['GASTO'] == 'COMPRAS', 'OTROS',
                                                                                           np.where(prueba22['GASTO']== 'DERECHOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                    np.where(prueba22['GASTO']== 'ENERGIA ELECTRICA', 'COSTO',
                                                                                                             np.where(prueba22['GASTO']== 'GERENCIA VTAS', 'GASTO DE VENTAS',
                                                                                                                      np.where(prueba22['GASTO']== 'HONORARIOS ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                               np.where(prueba22['GASTO']== 'HONORARIOS CONTABLES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                        np.where(prueba22['GASTO']== 'HOSPEDAJE', 'GASTO DE VENTAS', 
                                                                                                                                                 np.where(prueba22['GASTO']== 'IMSS/INFONAVIT', 'OTROS',
                                                                                                                                                          np.where(prueba22['GASTO']== 'MAQUILAS GIC', 'COSTO',
                                                                                                                                                                   np.where(prueba22['GASTO']== 'MAQUINARIA', 'COSTO',
                                                                                                                                                                            np.where(prueba22['GASTO']== 'MTTO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                     np.where(prueba22['GASTO']== 'MTTO LOCAL', 'COSTO',
                                                                                                                                                                                              np.where(prueba22['GASTO']== 'NO DEDUCIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                       np.where(prueba22['GASTO'] == 'PAPELERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                np.where(prueba22['GASTO'] == 'PAQUETERIA', 'COSTO',
                                                                                                                                                                                                                         np.where(prueba22['GASTO'] == 'PEAJES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                  np.where(prueba22['GASTO'] == 'REPARACIONES ELECTRICAS', 'COSTO',
                                                                                                                                                                                                                                           np.where(prueba22['GASTO'] == 'SEGUROS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                    np.where(prueba22['GASTO'] == 'TELEFONO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                             np.where(prueba22['GASTO'] == 'TRANSPORTE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                      np.where(prueba22['GASTO'] == 'UNIFORME', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                               np.where(prueba22['GASTO'] == 'VALES DESPENSA', 'OTROS',
                                                                                                                                                                                                                                                                                        np.where(prueba22['GASTO'] == 'ALIMENTOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                 np.where(prueba22['GASTO'] == 'ARRENDAMIENTO LOCAL', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                          np.where(prueba22['GASTO'] == 'GERENCIA ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                   np.where(prueba22['GASTO'] == 'MOBILIARIO', 'GASTOS ADMINISTRATIVOS', 
                                                                                                                                                                                                                                                                                                                            np.where(prueba22['GASTO'] == 'SUSCRIPCIONES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                     np.where(prueba22['GASTO'] == 'MTTO TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                              np.where(prueba22['GASTO'] == 'SUBCONTRATOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                       np.where(prueba22['GASTO'] == 'MEDICOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                np.where(prueba22['GASTO'] == 'PUBLICIDAD', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                         np.where(prueba22['GASTO'] == 'FLETES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba22['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba22['GASTO'] == 'MENSAJERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba22['GASTO'] == 'ATENCION CLIENTES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba22['GASTO'] == 'SERV FUNERARIO ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                      np.where(prueba22['GASTO'] == 'SUELDOS DIRECCION', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                        np.where(prueba22['GASTO'] == 'SUELDOS PRODUCCION', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                 np.where(prueba22['GASTO'] == 'SUELDOS VENTAS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                          np.where(prueba22['GASTO'] == 'COMPRA COMPUTADORA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba22['GASTO'] == 'COMPRA TABLET ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba22['GASTO'] == 'FLETE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba22['GASTO'] == 'GASOLINA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba22['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      np.where(prueba22['GASTO'] == 'GASTOS IMPORTACION ', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               np.where(prueba22['GASTO'] == 'HONORARIOS JURIDICOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        np.where(prueba22['GASTO'] == 'MTTO OFICINA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 np.where(prueba22['GASTO'] == 'HONORARIOS PF', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          np.where(prueba22['GASTO'] == 'MAQUILAS', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   np.where(prueba22['GASTO'] == 'MONITOREO CAMARAS ADT', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            np.where(prueba22['GASTO'] == 'RENTA COPIADORA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     np.where(prueba22['GASTO'] == 'RENTA OFICINA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              np.where(prueba22['GASTO'] == 'SANITIZACION', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       np.where(prueba22['GASTO'] == 'MTTO MAQUINARIA', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       np.where(prueba22['GASTO'] == 'HOSPEDAJE ', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                np.where(prueba22['GASTO'] == 'COMBUSTIBLE ', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         np.where(prueba22['GASTO'] == 'BOTIQUIN', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba22['GASTO'] == 'ANTICIPO COMPRA AUTO', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba22['GASTO'] == 'ANTICIPO ', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba22['GASTO'] == 'CASETAS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba22['GASTO'] == 'COMPRA AUTO ', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      np.where(prueba22['GASTO'] == 'CREDITO ', 'GASTOS FINANCIEROS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               np.where(prueba22['GASTO'] == 'INSTALACION ELECTRICA', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        np.where(prueba22['GASTO'] == 'MTTO EQUIPO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 np.where(prueba22['GASTO'] == 'RENTA AUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          np.where(prueba22['GASTO'] == 'UNIFORMES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   np.where(prueba22['GASTO'] == 'VARIOS', 'GASTOS ADMINISTRATIVOS', 'OTROS'
                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                        )))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))
prueba23['GASTO']= prueba23['TIPO GASTO']
prueba23['GASTO']=np.where(prueba23['GASTO']=='COMISION BANCARIA', 'GASTOS FINANCIEROS',
                     np.where(prueba23['GASTO']== 'PAPELERIA','GASTOS ADMINISTRATIVOS',
                              np.where(prueba23['GASTO']== 'CAPACITACION', 'GASTOS ADMINISTRATIVOS',
                                       np.where(prueba23['GASTO'] == 'ARRENDAMIENTO FINANCIERO', 'GASTOS FINANCIEROS',
                                                np.where(prueba23['GASTO']== 'CALIBRACIONES', 'COSTO',
                                                         np.where(prueba23['GASTO'] == 'COMBUSTIBLE', 'GASTO DE VENTAS',
                                                                  np.where(prueba23['GASTO']== 'COMBUSTIBLE','GASTO DE VENTAS',
                                                                           np.where(prueba23['GASTO']==  'COMISION VENTA', 'GASTO DE VENTAS',
                                                                                  np.where(prueba23['GASTO'] == 'COMPRAS', 'OTROS',
                                                                                           np.where(prueba23['GASTO']== 'DERECHOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                    np.where(prueba23['GASTO']== 'ENERGIA ELECTRICA', 'COSTO',
                                                                                                             np.where(prueba23['GASTO']== 'GERENCIA VTAS', 'GASTO DE VENTAS',
                                                                                                                      np.where(prueba23['GASTO']== 'HONORARIOS ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                               np.where(prueba23['GASTO']== 'HONORARIOS CONTABLES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                        np.where(prueba23['GASTO']== 'HOSPEDAJE', 'GASTO DE VENTAS', 
                                                                                                                                                 np.where(prueba23['GASTO']== 'IMSS/INFONAVIT', 'OTROS',
                                                                                                                                                          np.where(prueba23['GASTO']== 'MAQUILAS GIC', 'COSTO',
                                                                                                                                                                   np.where(prueba23['GASTO']== 'MAQUINARIA', 'COSTO',
                                                                                                                                                                            np.where(prueba23['GASTO']== 'MTTO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                     np.where(prueba23['GASTO']== 'MTTO LOCAL', 'COSTO',
                                                                                                                                                                                              np.where(prueba23['GASTO']== 'NO DEDUCIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                       np.where(prueba23['GASTO'] == 'PAPELERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                np.where(prueba23['GASTO'] == 'PAQUETERIA', 'COSTO',
                                                                                                                                                                                                                         np.where(prueba23['GASTO'] == 'PEAJES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                  np.where(prueba23['GASTO'] == 'REPARACIONES ELECTRICAS', 'COSTO',
                                                                                                                                                                                                                                           np.where(prueba23['GASTO'] == 'SEGUROS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                    np.where(prueba23['GASTO'] == 'TELEFONO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                             np.where(prueba23['GASTO'] == 'TRANSPORTE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                      np.where(prueba23['GASTO'] == 'UNIFORME', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                               np.where(prueba23['GASTO'] == 'VALES DESPENSA', 'OTROS',
                                                                                                                                                                                                                                                                                        np.where(prueba23['GASTO'] == 'ALIMENTOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                 np.where(prueba23['GASTO'] == 'ARRENDAMIENTO LOCAL', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                          np.where(prueba23['GASTO'] == 'GERENCIA ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                   np.where(prueba23['GASTO'] == 'MOBILIARIO', 'GASTOS ADMINISTRATIVOS', 
                                                                                                                                                                                                                                                                                                                            np.where(prueba23['GASTO'] == 'SUSCRIPCIONES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                     np.where(prueba23['GASTO'] == 'MTTO TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                              np.where(prueba23['GASTO'] == 'SUBCONTRATOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                       np.where(prueba23['GASTO'] == 'MEDICOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                np.where(prueba23['GASTO'] == 'PUBLICIDAD', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                         np.where(prueba23['GASTO'] == 'FLETES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba23['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba23['GASTO'] == 'MENSAJERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba23['GASTO'] == 'ATENCION CLIENTES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba23['GASTO'] == 'SERV FUNERARIO ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                      np.where(prueba23['GASTO'] == 'SUELDOS DIRECCION', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                        np.where(prueba23['GASTO'] == 'SUELDOS PRODUCCION', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                 np.where(prueba23['GASTO'] == 'SUELDOS VENTAS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                          np.where(prueba23['GASTO'] == 'COMPRA COMPUTADORA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba23['GASTO'] == 'COMPRA TABLET ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba23['GASTO'] == 'FLETE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba23['GASTO'] == 'GASOLINA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba23['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      np.where(prueba23['GASTO'] == 'GASTOS IMPORTACION ', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               np.where(prueba23['GASTO'] == 'HONORARIOS JURIDICOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        np.where(prueba23['GASTO'] == 'MTTO OFICINA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 np.where(prueba23['GASTO'] == 'HONORARIOS PF', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          np.where(prueba23['GASTO'] == 'MAQUILAS', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   np.where(prueba23['GASTO'] == 'MONITOREO CAMARAS ADT', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            np.where(prueba23['GASTO'] == 'RENTA COPIADORA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     np.where(prueba23['GASTO'] == 'RENTA OFICINA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              np.where(prueba23['GASTO'] == 'SANITIZACION', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       np.where(prueba23['GASTO'] == 'MTTO MAQUINARIA', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       np.where(prueba23['GASTO'] == 'HOSPEDAJE ', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                np.where(prueba23['GASTO'] == 'COMBUSTIBLE ', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         np.where(prueba23['GASTO'] == 'BOTIQUIN', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  np.where(prueba23['GASTO'] == 'ANTICIPO COMPRA AUTO', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           np.where(prueba23['GASTO'] == 'ANTICIPO ', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    np.where(prueba23['GASTO'] == 'CASETAS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             np.where(prueba23['GASTO'] == 'COMPRA AUTO ', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      np.where(prueba23['GASTO'] == 'CREDITO ', 'GASTOS FINANCIEROS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               np.where(prueba23['GASTO'] == 'INSTALACION ELECTRICA', 'COSTO',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        np.where(prueba23['GASTO'] == 'MTTO EQUIPO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 np.where(prueba23['GASTO'] == 'RENTA AUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          np.where(prueba23['GASTO'] == 'UNIFORMES', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   np.where(prueba23['GASTO'] == 'VARIOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            np.where(prueba23['GASTO'] == 'MTTO OFICINA ', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     np.where(prueba23['GASTO'] == 'MTT OFICINA', 'GASTOS ADMINISTRATIVOS', 'OTROS'
                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                                                                                                                                                                                                        )))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))))


for index, row in devoluciones2.iterrows():
    if row['CANTD_TOT'] <= 8000:
        devoluciones2.at[index, 'NOMBRE'] = 'OTROS'


for index, row in notas_credito2.iterrows():
    if row['CANTD_TOT'] <= 8000:
        notas_credito2.at[index, 'NOMBRE'] = 'OTROS'


for index, row in facturacion3.iterrows():
    if row['CANTD_TOT'] <= 8000:
        facturacion3.at[index, 'NOMBRE'] = 'OTROS'

gastos_22.columns = gastos_22.columns.str.replace('PROOVEDOR', 'PROVEEDOR')
gastos_22.rename(columns={ 'PROOVEDOR': 'PROVEEDOR' })
gastos_23.columns = gastos_23.columns.str.replace('PROOVEDOR', 'PROVEEDOR')

df_compras20 = gastos_20[(gastos_20['TIPO GASTO'] == 'COMPRAS') & (gastos_20['TOTAL MX'] > 5000)]
df_compras21 = gastos_21[(gastos_21['TIPO GASTO'] == 'COMPRAS') & (gastos_21['TOTAL MX'] > 5000)]
df_compras22 = gastos_22[(gastos_22['TIPO GASTO'] == 'COMPRAS') & (gastos_22['TOTAL MX'] > 5000)]
df_compras23 = gastos_23[(gastos_23['TIPO GASTO'] == 'COMPRAS') & (gastos_23['TOTAL MX'] > 5000)]

Principal = '#ba1424'
Complemento = '#746c6c'
Calor =['#ba1424', '#c52f31','#680c09','#746c6c', '#8a0e1a', '#444441']


d=facturacion
facturacion['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))

d=devoluciones
devoluciones['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))


d=notas_credito
notas_credito['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))
d=gastos_20
gastos_20['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))

d=gastos_21
gastos_21['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))

d=gastos_22
gastos_22['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))
d=gastos_23
gastos_23['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))


#st.header('Ingresos')
colored_header(
    label="Ingresos",
    description='',
    color_name="red-70",)

fact=facturacion[['MES','Mes','AÑO','CVE_CLPV','CANTD_TOT','DES_TOT']]
dev = devoluciones[['MES','Mes','AÑO','CVE_CLPV','CANTD_TOT']]
nots = notas_credito[['MES','Mes','AÑO','CVE_CLPV','CANTD_TOT']]

fact2019 = fact[fact['AÑO']==2019]
fact2020 = fact[fact['AÑO']==2020]
fact2021 = fact[fact['AÑO']==2021]
fact2022 = fact[fact['AÑO']==2022]
fact2023 = fact[fact['AÑO']==2023]

d19=pd.DataFrame()
d20=pd.DataFrame()
d21=pd.DataFrame()
d22=pd.DataFrame()
d23=pd.DataFrame()

d19['CANT_FACT'] = fact2019.groupby(['MES'])['CANTD_TOT'].sum()
d20['CANT_FACT'] = fact2020.groupby(['MES'])['CANTD_TOT'].sum()
d21['CANT_FACT'] = fact2021.groupby(['MES'])['CANTD_TOT'].sum()
d22['CANT_FACT'] = fact2022.groupby(['MES'])['CANTD_TOT'].sum()
d23['CANT_FACT'] = fact2023.groupby(['MES'])['CANTD_TOT'].sum()
d19['CANT_DESC'] = fact2019.groupby(['MES'])['DES_TOT'].sum()
d20['CANT_DESC'] = fact2020.groupby(['MES'])['DES_TOT'].sum()
d21['CANT_DESC'] = fact2021.groupby(['MES'])['DES_TOT'].sum()
d22['CANT_DESC'] = fact2022.groupby(['MES'])['DES_TOT'].sum()
d23['CANT_DESC'] = fact2023.groupby(['MES'])['DES_TOT'].sum()

dev2019 = dev[dev['AÑO']==2019]
dev2020 = dev[dev['AÑO']==2020]
dev2021 = dev[dev['AÑO']==2021]
dev2022 = dev[dev['AÑO']==2022]
dev2023 = dev[dev['AÑO']==2023]
d19['CANT_DEV'] = dev2019.groupby(['MES'])['CANTD_TOT'].sum()
d20['CANT_DEV'] = dev2020.groupby(['MES'])['CANTD_TOT'].sum()
d21['CANT_DEV'] = dev2021.groupby(['MES'])['CANTD_TOT'].sum()
d22['CANT_DEV'] = dev2022.groupby(['MES'])['CANTD_TOT'].sum()
d23['CANT_DEV'] = dev2023.groupby(['MES'])['CANTD_TOT'].sum()

nots2019 = nots[nots['AÑO']==2019]
nots2020 = nots[nots['AÑO']==2020]
nots2021 = nots[nots['AÑO']==2021]
nots2022 = nots[nots['AÑO']==2022]
nots2023 = nots[nots['AÑO']==2023]

d19['CANT_NOT'] = nots2019.groupby(['MES'])['CANTD_TOT'].sum()
d20['CANT_NOT'] = nots2020.groupby(['MES'])['CANTD_TOT'].sum()
d21['CANT_NOT'] = nots2021.groupby(['MES'])['CANTD_TOT'].sum()
d22['CANT_NOT'] = nots2022.groupby(['MES'])['CANTD_TOT'].sum()
d23['CANT_NOT'] = nots2023.groupby(['MES'])['CANTD_TOT'].sum()

d19=d19.fillna(0)
d20=d20.fillna(0)
d21=d21.fillna(0)
d22=d22.fillna(0)
d23=d23.fillna(0)

d19 = d19.reset_index()
d20 = d20.reset_index()
d21 = d21.reset_index()
d22 = d22.reset_index()
d23 = d23.reset_index()

d19['INGR_TOT']=d19['CANT_FACT']+d19['CANT_NOT']-d19['CANT_DESC']-d19['CANT_DEV']
d20['INGR_TOT']=d20['CANT_FACT']+d20['CANT_NOT']-d20['CANT_DESC']-d20['CANT_DEV']
d21['INGR_TOT']=d21['CANT_FACT']+d21['CANT_NOT']-d21['CANT_DESC']-d21['CANT_DEV']
d22['INGR_TOT']=d22['CANT_FACT']+d22['CANT_NOT']-d22['CANT_DESC']-d22['CANT_DEV']
d23['INGR_TOT']=d23['CANT_FACT']+d23['CANT_NOT']-d23['CANT_DESC']-d23['CANT_DEV']


gas_20=gastos_20.groupby('MES').sum('Importe')
gas_21=gastos_21.groupby('MES').sum('Importe')
gas_22=gastos_22.groupby('MES').sum('Importe')
gas_23=gastos_23.groupby('MES').sum('Importe')
gas_20 = gas_20.reset_index()
gas_21 = gas_21.reset_index()
gas_22 = gas_22.reset_index()
gas_23 = gas_23.reset_index()


d20['GAS_COS']=gas_20['IMPORTE']
d21['GAS_COS']=gas_21['IMPORTE']
d22['GAS_COS']=gas_22['Importe']
d23['GAS_COS']=gas_23['Importe']

d20['GANANCIA NETA']=(d20['INGR_TOT']-d20['GAS_COS'])
d21['GANANCIA NETA']=(d21['INGR_TOT']-d21['GAS_COS'])
d22['GANANCIA NETA']=(d22['INGR_TOT']-d22['GAS_COS'])
d23['GANANCIA NETA']=(d23['INGR_TOT']-d23['GAS_COS'])

d20['RENTABILIDAD']=(d20['GANANCIA NETA']/d20['INGR_TOT'])
d21['RENTABILIDAD']=(d21['GANANCIA NETA']/d21['INGR_TOT'])
d22['RENTABILIDAD']=(d22['GANANCIA NETA']/d22['INGR_TOT'])
d23['RENTABILIDAD']=(d23['GANANCIA NETA']/d23['INGR_TOT'])

ing_tot=pd.DataFrame()
ing_tot['MES']=d20['MES']
ing_tot['2020']=d20['INGR_TOT']
ing_tot['2021']=d21['INGR_TOT']
ing_tot['2022']=d22['INGR_TOT']
ing_tot['2023']=d23['INGR_TOT']
ing_tot['Rentabilidad_2020']=d20['RENTABILIDAD']
ing_tot['Rentabilidad_2022']=d21['RENTABILIDAD']
ing_tot['Rentabilidad_2021']=d22['RENTABILIDAD']
ing_tot['Rentabilidad_2023']=d23['RENTABILIDAD']


d=ing_tot
ing_tot['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))


melted_data = pd.melt(ing_tot, id_vars=['Mes'], value_vars=['2020','2021', '2022','2023'], var_name='Año', value_name='Ingreso')

ing_total = alt.Chart(melted_data).mark_line(size=1.8,point=True).encode(
    x=alt.X('Mes',title='Mes',axis=alt.Axis(labelAngle=0),sort=['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul',
       'Agto', 'Sep', 'Oct', 'Nov', 'Dic']), 
    y='Ingreso', 
    color=alt.Color('Año', scale=alt.Scale(domain=['2020','2021', '2022','2023'], range=coloraños)),
    tooltip=['Año', 'Ingreso']
).properties(height=450,title='Ingresos por Año').interactive()

prom_ing=melted_data['Ingreso'].mean()

st.sidebar.image(logo, use_column_width=True)
año = st.sidebar.selectbox(
'Filtrar por Año',
    [2023,2022,2021,2020])

año=int(año)

if año != '':
    range_=[]
    if año == 2022:
      range_ =['#F37600','#E16702', '#C25E00','#FCA941']
    elif año == 2023:
      range_ =['#BA1424','#8A0E14', '#CB4C46','#E09490']
    elif año == 2021:
      range_ =['#005187','#6CB6F4', '#A7D3F8','#4589C4']
    elif año == 2020:
      range_ =['#7A5C3C','#BA9C7E', '#ECCBAB','#643c23']
    else:
      pass
    fact = facturacion[['Mes','AÑO','CVE_CLPV','CANTD_TOT','DES_TOT']]
    fact = fact[fact['AÑO']==año]

    dev = devoluciones[['Mes','AÑO','CVE_CLPV','CANTD_TOT']]
    dev = dev[dev['AÑO']==año]

    nots = notas_credito[['Mes','AÑO','CVE_CLPV','CANTD_TOT']]
    nots = nots[nots['AÑO']==2019]

    d=pd.DataFrame()
    d['CANT_FACT'] = fact.groupby(['Mes'])['CANTD_TOT'].sum()
    d['CANT_DESC'] = fact.groupby(['Mes'])['DES_TOT'].sum()
    d['CANT_DEV'] = dev.groupby(['Mes'])['CANTD_TOT'].sum()
    d['CANT_NOT'] = nots.groupby(['Mes'])['CANTD_TOT'].sum()
    d=d.fillna(0)
    d = d.reset_index()
    melted_data = pd.melt(d, id_vars=['Mes'], value_vars=['CANT_FACT','CANT_DESC', 'CANT_DEV','CANT_NOT'], var_name='Cuenta', value_name='Cantidad')
    ing_año = alt.Chart(melted_data).mark_line(size=1.8,point=True).encode(
      x=alt.X('Mes',title='MES',axis=alt.Axis(labelAngle=0),sort=['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul',
       'Agto', 'Sept', 'Oct', 'Nov', 'Dic']),
      y='Cantidad',  # Columna para los valores de las líneas
      color=alt.Color('Cuenta', scale=alt.Scale(domain=['CANT_FACT','CANT_DESC', 'CANT_DEV','CANT_NOT'], range=range_)),
      tooltip=['Cuenta', 'Cantidad']
        ).properties(height=450,title='Desglose de Ingresos %i'%año).interactive()

borr=['2020','2021','2022','2023']
ing_tot=ing_tot.drop(borr,axis=1)
ing_tot=ing_tot.rename(columns={'Rentabilidad_2020':'2020','Rentabilidad_2021':'2021','Rentabilidad_2022':'2022','Rentabilidad_2023':'2023'})

melted_data = pd.melt(ing_tot, id_vars=['Mes'], value_vars=['2020','2021','2022','2023'], var_name='Año', value_name='Rentabilidad')

interval=alt.selection_interval() 
graf_rent = alt.Chart(melted_data).mark_line(size=1.5,point=True).encode(
    x = alt.X('Mes',title='MES',axis=alt.Axis(labelAngle=0),sort=['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul',
       'Agto', 'Sept', 'Oct', 'Nov', 'Dic']),
    y='Rentabilidad', 
    color=alt.Color('Año', scale=alt.Scale(domain=['2020','2021','2022','2023'], range=coloraños)),
    tooltip=['Año', 'Rentabilidad']
    ).properties(height=450,title='Rentabilidad de margen neto').add_selection(interval)

graf_rent1=alt.Chart(melted_data).mark_rule(
    color='#F7BD53',
    strokeDash=[10,10],
    opacity=0.9
).encode(
    y = alt.Y('mean(Rentabilidad)',title='Rentabilidad'),
).properties(height=450)
graf_rent=alt.layer(graf_rent,graf_rent1)

prom_ing=round(prom_ing,2)
square_style = "background-color:grey; padding: 10px; border-radius: 10px;font-size: 20px; color: white;text-align: center"


b1, b2 = st.columns(2)
with b1:
    b1.metric(label="Ingreso Promedio", value='$%i' % prom_ing)
   #b2.markdown(('<div style="{}">Ingreso Promedio:<br>       $%f</div>'% prom_ing).format(square_style), unsafe_allow_html=True) #<br>
#with b2: 
#    b2.metric(label="Monto Adeudado", value='$%f' %vencido_m1)
    #style_metric_cards()

col1, col2= st.columns(2)
with col1:
    st.altair_chart(ing_total,use_container_width=True)
with col2:	
    st.altair_chart(ing_año,use_container_width=True)
    
##MÉTRICAS 1
m_rent=pd.DataFrame()
m_rent[['RENTABILIDAD','MES']]=d23[['RENTABILIDAD','MES']].tail(3)
m_rent=m_rent.reset_index(drop=True)
d=m_rent
m_rent['Mes']=np.where(d['MES']==1,'Enero',
                     np.where(d['MES']==2,'Febrero',
                              np.where(d['MES']==3,'Marzo',
                                       np.where(d['MES']==4,'Abril',
                                                np.where(d['MES']==5,'Mayo',
                                                         np.where(d['MES']==6,'Junio',
                                                                  np.where(d['MES']==7,'Julio',
                                                                           np.where(d['MES']==8,'Agosto',
                                                                                    np.where(d['MES']==9,'Septiembre',
                                                                                             np.where(d['MES']==10,'Octubre',
                                                                                                      np.where(d['MES']==11,'Noviembre','Diciembre')))))))))))

mrent_act=round(m_rent.at[0, 'RENTABILIDAD'],3)
mrent_ant=m_rent.at[1, 'RENTABILIDAD']
mes_act=m_rent.at[0, 'Mes']
mes_ant=m_rent.at[1, 'Mes']

crec_rent=((mrent_act-mrent_ant)/mrent_ant)*100
crec_rent=round(crec_rent,2)

vencido_m=saldos['MONTO ADEUDADO'][saldos['TIPO']=='CARTERA VENCIDA'].sum()
vencido_m1=round(vencido_m,2)
total_m=saldos['MONTO ADEUDADO'].sum()
total_m1=round(total_m,2)

porcen=100*vencido_m1/total_m1
porcen = "{:.2f}%".format(porcen)


square_style = "background-color: gray; padding: 10px; border-radius: 5px;font-size: 25px; color: white;text-align: center"

#st.header('Rentabilidad y Cobranza')
colored_header(
    label="Rentabilidad y Cobranza",
        description='',
    color_name="red-70",)

b1, b2 = st.columns(2)
with b1:
    b1.metric(label="Rentabilidad %s"%mes_act, value=mrent_act, delta='%f '%crec_rent)
#with b3:
#    b3.markdown(('<div style="{}">Monto Adeudado<br>$%f</div>'% vencido_m1).format(square_style), unsafe_allow_html=True) #<br>
with b2:
    b2.metric(label="Monto Total Adeudado", value='$%i' %total_m1)

    

actual= datetime(2023, 3, 26, 21, 57, 54, 615623) #datetime.now() datetime(2023, 3, 26, 21, 57, 54, 615623)
saldos['FECHA_ACT']=actual
saldos['TIPO'] = np.where(saldos['FECHA_VENCIMIENTO'] >= saldos['FECHA_ACT'], 'Crédito', 'Vencido')
saldos['dias'] = saldos['FECHA_VENCIMIENTO'] - saldos['FECHA_FACTURA'] 
saldos['TIPO_DIAS'] = np.where(saldos['dias'] <= '30 days' , '1-30', '31-60 o 60+')
cobranza = pd.DataFrame()
cobranza['MONTO ADEUDADO'] = saldos.groupby(['TIPO','TIPO_DIAS'])['MONTO ADEUDADO'].sum()
cobranza = cobranza.reset_index()
cobranza['TIPO CARTERA'] = cobranza['TIPO'] + ' ' + cobranza['TIPO_DIAS']
saldos_1=saldos[['NOMBRE', 'FACTURA','MONTO ADEUDADO', 'TIPO', 'TIPO_DIAS']]
saldos_1['TIPO CARTERA'] = saldos_1['TIPO'] + ' ' + saldos_1['TIPO_DIAS']

click=alt.selection_multi(encodings=['color'])
graf1 = alt.Chart(cobranza).mark_bar().encode(
    x= alt.X('TIPO CARTERA',title='TIPO CARTERA',axis=alt.Axis(labelAngle=65),sort=alt.EncodingSortField(field="MONTO ADEUDADO", order='descending')),
    y= 'MONTO ADEUDADO',
    color=alt.condition(click,'TIPO CARTERA',alt.value('#ffe7e7'),)
).properties(height=300,width=300,title='Cobranza').add_selection(click)
graf1_2=alt.Chart(cobranza).mark_text(
    color='white',
    font='Trebuchet MS',
    fontSize=11,
    dy=13,
).encode(
    x=alt.X('TIPO CARTERA',sort=alt.EncodingSortField(field="MONTO ADEUDADO", order='descending')),
    y=alt.Y('MONTO ADEUDADO'),
    text=alt.Text('MONTO ADEUDADO'),
).properties(height=300,width=300)

graf1_1=alt.layer(graf1,graf1_2)

graf = alt.Chart(saldos_1).mark_bar().encode(
    x= alt.X('NOMBRE',title='CLIENTE',axis=alt.Axis(labelAngle=90),sort=alt.EncodingSortField(field="MONTO ADEUDADO", order='descending')),
    y= 'MONTO ADEUDADO',
    color=alt.Color('TIPO CARTERA', scale=alt.Scale(range=['#8c8c8c','#8c8c8c','#ba1424','#ba1424'])), #ffb999
    tooltip=['NOMBRE','MONTO ADEUDADO']
).properties(height=300,title='Clientes deudores').transform_filter(click) 
graf_cobranza= graf1_1 | graf

col1, col2= st.columns(2)
with col1:
    #st.markdown('Rentabilidad por año')
    st.altair_chart(graf_rent,use_container_width=True)
with col2:
    st.altair_chart(graf_cobranza,use_container_width=True)       
         

colored_header(
    label="Gastos y Costos",
    description='',
    color_name="red-70",)

dg=gastos_20[['FECHA','TIPO GASTO','IMPORTE']]
dg['MES']=dg['FECHA'].dt.month
dg['GASTO']=dg['TIPO GASTO']
dg['GASTO']=np.where(dg['GASTO']=='COMISION BANCARIA', 'GASTOS FINANCIEROS',
                     np.where(dg['GASTO']== 'PAPELERIA','GASTOS ADMINISTRATIVOS',
                              np.where(dg['GASTO']== 'CAPACITACION', 'GASTOS ADMINISTRATIVOS',
                                       np.where(dg['GASTO'] == 'ARRENDAMIENTO FINANCIERO', 'GASTOS FINANCIEROS',
                                                np.where(dg['GASTO']== 'CALIBRACIONES', 'GASTO DE VENTAS',
                                                         np.where(dg['GASTO'] == 'COMBUSTIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                  np.where(dg['GASTO']== 'COMBUSTIBLE','GASTO DE VENTAS',
                                                                           np.where(dg['GASTO']==  'COMISION VENTA', 'GASTO DE VENTAS',
                                                                                  np.where(dg['GASTO'] == 'COMPRAS', 'OTROS',
                                                                                           np.where(dg['GASTO']== 'DERECHOS', 'OTROS',
                                                                                                    np.where(dg['GASTO']== 'ENERGIA ELECTRICA', 'GASTOS ADMINISTRATIVOS',
                                                                                                             np.where(dg['GASTO']== 'GERENCIA VTAS', 'GASTO DE VENTAS',
                                                                                                                      np.where(dg['GASTO']== 'HONORARIOS ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                               np.where(dg['GASTO']== 'HONORARIOS CONTABLES', 'OTROS',
                                                                                                                                        np.where(dg['GASTO']== 'HOSPEDAJE', 'OTROS', 
                                                                                                                                                 np.where(dg['GASTO']== 'IMSS/INFONAVIT', 'OTROS',
                                                                                                                                                          np.where(dg['GASTO']== 'MAQUILAS GIC', 'OTROS',
                                                                                                                                                                   np.where(dg['GASTO']== 'MAQUINARIA', 'OTROS',
                                                                                                                                                                            np.where(dg['GASTO']== 'MTTO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                     np.where(dg['GASTO']== 'MTTO LOCAL', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                              np.where(dg['GASTO']== 'NO DEDUCIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                       np.where(dg['GASTO'] == 'PAPELERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                np.where(dg['GASTO'] == 'PAQUETERIA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                         np.where(dg['GASTO'] == 'PEAJES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                  np.where(dg['GASTO'] == 'REPARACIONES ELECTRICAS', 'OTROS',
                                                                                                                                                                                                                                           np.where(dg['GASTO'] == 'SEGUROS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                    np.where(dg['GASTO'] == 'TELEFONO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                             np.where(dg['GASTO'] == 'TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                      np.where(dg['GASTO'] == 'UNIFORME', 'GASTOS OPERATIVOS',
                                                                                                                                                                                                                                                                               np.where(dg['GASTO'] == 'VALES DESPENSA', 'MANO DE OBRA',
                                                                                                                                                                                                                                                                                        np.where(dg['GASTO'] == 'ALIMENTOS', 'OTROS',
                                                                                                                                                                                                                                                                                                 np.where(dg['GASTO'] == 'ARRENDAMIENTO LOCAL', 'OTROS',
                                                                                                                                                                                                                                                                                                          np.where(dg['GASTO'] == 'GERENCIA ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                   np.where(dg['GASTO'] == 'MOBILIARIO', 'GASTOS OPERATIVOS', 
                                                                                                                                                                                                                                                                                                                            np.where(dg['GASTO'] == 'SUSCRIPCIONES', 'OTROS',
                                                                                                                                                                                                                                                                                                                                     np.where(dg['GASTO'] == 'MTTO TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                              np.where(dg['GASTO'] == 'SUBCONTRATOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                       np.where(dg['GASTO'] == 'MEDICOS', 'OTROS',
                                                                                                                                                                                                                                                                                                                                                                np.where(dg['GASTO'] == 'PUBLICIDAD', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                         np.where(dg['GASTO'] == 'FLETES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                  np.where(dg['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                           np.where(dg['GASTO'] == 'MENSAJERIA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                    np.where(dg['GASTO'] == 'ATENCION CLIENTES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                             np.where(dg['GASTO'] == 'SERV FUNERARIO ', 'OTROS', 'OTROS'
                                                                                                                                                                                                                                                                                                                                                                                                                                        ))))))))))))))))))))))))))))))))))))))))))))

otros=pd.DataFrame()
gfin=pd.DataFrame()
gadmin=pd.DataFrame()
gvnt=pd.DataFrame()
manob=pd.DataFrame()
gope=pd.DataFrame()
otros_=dg[dg['GASTO']=='OTROS']
otros['IMPORTE']=otros_.groupby('MES')['IMPORTE'].sum()
gfin_=dg[dg['GASTO']=='GASTOS FINANCIEROS']
gfin['IMPORTE']=gfin_.groupby('MES')['IMPORTE'].sum()
gadmin_=dg[dg['GASTO']=='GASTOS ADMINISTRATIVOS']
gadmin['IMPORTE']=gadmin_.groupby('MES')['IMPORTE'].sum()
gvnt_=dg[dg['GASTO']=='GASTO DE VENTAS']
gvnt['IMPORTE']=gvnt_.groupby('MES')['IMPORTE'].sum()
manob_=dg[dg['GASTO']=='MANO DE OBRA']
manob['IMPORTE']=manob_.groupby('MES')['IMPORTE'].sum()
gope_=dg[dg['GASTO']=='GASTOS OPERATIVOS']
gope['IMPORTE']=gope_.groupby('MES')['IMPORTE'].sum()
otros= otros.reset_index()
gfin = gfin.reset_index()
gadmin= gadmin.reset_index()
gvnt = gvnt.reset_index()
manob= manob.reset_index()
gope = gope.reset_index()
dgc=pd.DataFrame()
dgc['MES']=otros['MES']
dgc['OTROS']=otros['IMPORTE']
dgc['GASTOS FINANCIEROS']=gfin['IMPORTE']
dgc['GASTOS ADMIN.']=gadmin['IMPORTE']
dgc['GASTOS VENTAS']=gvnt['IMPORTE']
dgc['MANO DE OBRA']=manob['IMPORTE']
dgc['GASTOS OPERATIVOS']=gope['IMPORTE']
dgc = dgc.fillna(0)
dgc['2020']=dgc['OTROS']+dgc['GASTOS FINANCIEROS']+dgc['GASTOS ADMIN.']+dgc['GASTOS VENTAS']+dgc['MANO DE OBRA']+dgc['GASTOS OPERATIVOS']
dgc=dgc.drop(['OTROS', 'GASTOS FINANCIEROS', 'GASTOS ADMIN.', 'GASTOS VENTAS',
       'MANO DE OBRA', 'GASTOS OPERATIVOS'], axis=1)

dg=gastos_21[['FECHA','TIPO GASTO','IMPORTE']]
dg['MES']=dg['FECHA'].dt.month
dg['GASTO']=dg['TIPO GASTO']
dg['GASTO']=np.where(dg['GASTO']=='COMISION BANCARIA', 'GASTOS FINANCIEROS',
                     np.where(dg['GASTO']== 'PAPELERIA','GASTOS ADMINISTRATIVOS',
                              np.where(dg['GASTO']== 'CAPACITACION', 'GASTOS ADMINISTRATIVOS',
                                       np.where(dg['GASTO'] == 'ARRENDAMIENTO FINANCIERO', 'GASTOS FINANCIEROS',
                                                np.where(dg['GASTO']== 'CALIBRACIONES', 'GASTO DE VENTAS',
                                                         np.where(dg['GASTO'] == 'COMBUSTIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                  np.where(dg['GASTO']== 'COMBUSTIBLE','GASTO DE VENTAS',
                                                                           np.where(dg['GASTO']==  'COMISION VENTA', 'GASTO DE VENTAS',
                                                                                  np.where(dg['GASTO'] == 'COMPRAS', 'OTROS',
                                                                                           np.where(dg['GASTO']== 'DERECHOS', 'OTROS',
                                                                                                    np.where(dg['GASTO']== 'ENERGIA ELECTRICA', 'GASTOS ADMINISTRATIVOS',
                                                                                                             np.where(dg['GASTO']== 'GERENCIA VTAS', 'GASTO DE VENTAS',
                                                                                                                      np.where(dg['GASTO']== 'HONORARIOS ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                               np.where(dg['GASTO']== 'HONORARIOS CONTABLES', 'OTROS',
                                                                                                                                        np.where(dg['GASTO']== 'HOSPEDAJE', 'OTROS', 
                                                                                                                                                 np.where(dg['GASTO']== 'IMSS/INFONAVIT', 'OTROS',
                                                                                                                                                          np.where(dg['GASTO']== 'MAQUILAS GIC', 'OTROS',
                                                                                                                                                                   np.where(dg['GASTO']== 'MAQUINARIA', 'OTROS',
                                                                                                                                                                            np.where(dg['GASTO']== 'MTTO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                     np.where(dg['GASTO']== 'MTTO LOCAL', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                              np.where(dg['GASTO']== 'NO DEDUCIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                       np.where(dg['GASTO'] == 'PAPELERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                np.where(dg['GASTO'] == 'PAQUETERIA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                         np.where(dg['GASTO'] == 'PEAJES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                  np.where(dg['GASTO'] == 'REPARACIONES ELECTRICAS', 'OTROS',
                                                                                                                                                                                                                                           np.where(dg['GASTO'] == 'SEGUROS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                    np.where(dg['GASTO'] == 'TELEFONO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                             np.where(dg['GASTO'] == 'TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                      np.where(dg['GASTO'] == 'UNIFORME', 'GASTOS OPERATIVOS',
                                                                                                                                                                                                                                                                               np.where(dg['GASTO'] == 'VALES DESPENSA', 'MANO DE OBRA',
                                                                                                                                                                                                                                                                                        np.where(dg['GASTO'] == 'ALIMENTOS', 'OTROS',
                                                                                                                                                                                                                                                                                                 np.where(dg['GASTO'] == 'ARRENDAMIENTO LOCAL', 'OTROS',
                                                                                                                                                                                                                                                                                                          np.where(dg['GASTO'] == 'GERENCIA ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                   np.where(dg['GASTO'] == 'MOBILIARIO', 'GASTOS OPERATIVOS', 
                                                                                                                                                                                                                                                                                                                            np.where(dg['GASTO'] == 'SUSCRIPCIONES', 'OTROS',
                                                                                                                                                                                                                                                                                                                                     np.where(dg['GASTO'] == 'MTTO TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                              np.where(dg['GASTO'] == 'SUBCONTRATOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                       np.where(dg['GASTO'] == 'MEDICOS', 'OTROS',
                                                                                                                                                                                                                                                                                                                                                                np.where(dg['GASTO'] == 'PUBLICIDAD', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                         np.where(dg['GASTO'] == 'FLETES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                  np.where(dg['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                           np.where(dg['GASTO'] == 'MENSAJERIA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                    np.where(dg['GASTO'] == 'ATENCION CLIENTES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                             np.where(dg['GASTO'] == 'SERV FUNERARIO ', 'OTROS', 'OTROS'
                                                                                                                                                                                                                                                                                                                                                                                                                                        ))))))))))))))))))))))))))))))))))))))))))))
otros=pd.DataFrame()
gfin=pd.DataFrame()
gadmin=pd.DataFrame()
gvnt=pd.DataFrame()
manob=pd.DataFrame()
gope=pd.DataFrame()
otros_=dg[dg['GASTO']=='OTROS']
otros['IMPORTE']=otros_.groupby('MES')['IMPORTE'].sum()
gfin_=dg[dg['GASTO']=='GASTOS FINANCIEROS']
gfin['IMPORTE']=gfin_.groupby('MES')['IMPORTE'].sum()
gadmin_=dg[dg['GASTO']=='GASTOS ADMINISTRATIVOS']
gadmin['IMPORTE']=gadmin_.groupby('MES')['IMPORTE'].sum()
gvnt_=dg[dg['GASTO']=='GASTO DE VENTAS']
gvnt['IMPORTE']=gvnt_.groupby('MES')['IMPORTE'].sum()
manob_=dg[dg['GASTO']=='MANO DE OBRA']
manob['IMPORTE']=manob_.groupby('MES')['IMPORTE'].sum()
gope_=dg[dg['GASTO']=='GASTOS OPERATIVOS']
gope['IMPORTE']=gope_.groupby('MES')['IMPORTE'].sum()
otros= otros.reset_index()
gfin = gfin.reset_index()
gadmin= gadmin.reset_index()
gvnt = gvnt.reset_index()
manob= manob.reset_index()
gope = gope.reset_index()
dgc['MES']=otros['MES']
dgc['OTROS']=otros['IMPORTE']
dgc['GASTOS FINANCIEROS']=gfin['IMPORTE']
dgc['GASTOS ADMIN.']=gadmin['IMPORTE']
dgc['GASTOS VENTAS']=gvnt['IMPORTE']
dgc['MANO DE OBRA']=manob['IMPORTE']
dgc['GASTOS OPERATIVOS']=gope['IMPORTE']
dgc = dgc.fillna(0)
dgc['2021']=dgc['OTROS']+dgc['GASTOS FINANCIEROS']+dgc['GASTOS ADMIN.']+dgc['GASTOS VENTAS']+dgc['MANO DE OBRA']+dgc['GASTOS OPERATIVOS']
dgc=dgc.drop(['OTROS', 'GASTOS FINANCIEROS', 'GASTOS ADMIN.', 'GASTOS VENTAS',
       'MANO DE OBRA', 'GASTOS OPERATIVOS'], axis=1)


gastos_22=gastos_22.rename(columns={'Importe':'IMPORTE'})
dg=gastos_22[['FECHA','TIPO GASTO','IMPORTE']]
dg['MES']=dg['FECHA'].dt.month
dg['GASTO']=dg['TIPO GASTO']
dg['GASTO']=np.where(dg['GASTO']=='COMISION BANCARIA', 'GASTOS FINANCIEROS',
                     np.where(dg['GASTO']== 'PAPELERIA','GASTOS ADMINISTRATIVOS',
                              np.where(dg['GASTO']== 'CAPACITACION', 'GASTOS ADMINISTRATIVOS',
                                       np.where(dg['GASTO'] == 'ARRENDAMIENTO FINANCIERO', 'GASTOS FINANCIEROS',
                                                np.where(dg['GASTO']== 'CALIBRACIONES', 'GASTO DE VENTAS',
                                                         np.where(dg['GASTO'] == 'COMBUSTIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                  np.where(dg['GASTO']== 'COMBUSTIBLE','GASTO DE VENTAS',
                                                                           np.where(dg['GASTO']==  'COMISION VENTA', 'GASTO DE VENTAS',
                                                                                  np.where(dg['GASTO'] == 'COMPRAS', 'OTROS',
                                                                                           np.where(dg['GASTO']== 'DERECHOS', 'OTROS',
                                                                                                    np.where(dg['GASTO']== 'ENERGIA ELECTRICA', 'GASTOS ADMINISTRATIVOS',
                                                                                                             np.where(dg['GASTO']== 'GERENCIA VTAS', 'GASTO DE VENTAS',
                                                                                                                      np.where(dg['GASTO']== 'HONORARIOS ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                               np.where(dg['GASTO']== 'HONORARIOS CONTABLES', 'OTROS',
                                                                                                                                        np.where(dg['GASTO']== 'HOSPEDAJE', 'OTROS', 
                                                                                                                                                 np.where(dg['GASTO']== 'IMSS/INFONAVIT', 'OTROS',
                                                                                                                                                          np.where(dg['GASTO']== 'MAQUILAS GIC', 'OTROS',
                                                                                                                                                                   np.where(dg['GASTO']== 'MAQUINARIA', 'OTROS',
                                                                                                                                                                            np.where(dg['GASTO']== 'MTTO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                     np.where(dg['GASTO']== 'MTTO LOCAL', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                              np.where(dg['GASTO']== 'NO DEDUCIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                       np.where(dg['GASTO'] == 'PAPELERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                np.where(dg['GASTO'] == 'PAQUETERIA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                         np.where(dg['GASTO'] == 'PEAJES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                  np.where(dg['GASTO'] == 'REPARACIONES ELECTRICAS', 'OTROS',
                                                                                                                                                                                                                                           np.where(dg['GASTO'] == 'SEGUROS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                    np.where(dg['GASTO'] == 'TELEFONO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                             np.where(dg['GASTO'] == 'TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                      np.where(dg['GASTO'] == 'UNIFORME', 'GASTOS OPERATIVOS',
                                                                                                                                                                                                                                                                               np.where(dg['GASTO'] == 'VALES DESPENSA', 'MANO DE OBRA',
                                                                                                                                                                                                                                                                                        np.where(dg['GASTO'] == 'ALIMENTOS', 'OTROS',
                                                                                                                                                                                                                                                                                                 np.where(dg['GASTO'] == 'ARRENDAMIENTO LOCAL', 'OTROS',
                                                                                                                                                                                                                                                                                                          np.where(dg['GASTO'] == 'GERENCIA ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                   np.where(dg['GASTO'] == 'MOBILIARIO', 'GASTOS OPERATIVOS', 
                                                                                                                                                                                                                                                                                                                            np.where(dg['GASTO'] == 'SUSCRIPCIONES', 'OTROS',
                                                                                                                                                                                                                                                                                                                                     np.where(dg['GASTO'] == 'MTTO TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                              np.where(dg['GASTO'] == 'SUBCONTRATOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                       np.where(dg['GASTO'] == 'MEDICOS', 'OTROS',
                                                                                                                                                                                                                                                                                                                                                                np.where(dg['GASTO'] == 'PUBLICIDAD', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                         np.where(dg['GASTO'] == 'FLETES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                  np.where(dg['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                           np.where(dg['GASTO'] == 'MENSAJERIA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                    np.where(dg['GASTO'] == 'ATENCION CLIENTES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                             np.where(dg['GASTO'] == 'SERV FUNERARIO ', 'OTROS', 'OTROS'
                                                                                                                                                                                                                                                                                                                                                                                                                                        ))))))))))))))))))))))))))))))))))))))))))))
otros=pd.DataFrame()
gfin=pd.DataFrame()
gadmin=pd.DataFrame()
gvnt=pd.DataFrame()
manob=pd.DataFrame()
gope=pd.DataFrame()
otros_=dg[dg['GASTO']=='OTROS']
otros['IMPORTE']=otros_.groupby('MES')['IMPORTE'].sum()
gfin_=dg[dg['GASTO']=='GASTOS FINANCIEROS']
gfin['IMPORTE']=gfin_.groupby('MES')['IMPORTE'].sum()
gadmin_=dg[dg['GASTO']=='GASTOS ADMINISTRATIVOS']
gadmin['IMPORTE']=gadmin_.groupby('MES')['IMPORTE'].sum()
gvnt_=dg[dg['GASTO']=='GASTO DE VENTAS']
gvnt['IMPORTE']=gvnt_.groupby('MES')['IMPORTE'].sum()
manob_=dg[dg['GASTO']=='MANO DE OBRA']
manob['IMPORTE']=manob_.groupby('MES')['IMPORTE'].sum()
gope_=dg[dg['GASTO']=='GASTOS OPERATIVOS']
gope['IMPORTE']=gope_.groupby('MES')['IMPORTE'].sum()
otros= otros.reset_index()
gfin = gfin.reset_index()
gadmin= gadmin.reset_index()
gvnt = gvnt.reset_index()
manob= manob.reset_index()
gope = gope.reset_index()
dgc['MES']=otros['MES']
dgc['OTROS']=otros['IMPORTE']
dgc['GASTOS FINANCIEROS']=gfin['IMPORTE']
dgc['GASTOS ADMIN.']=gadmin['IMPORTE']
dgc['GASTOS VENTAS']=gvnt['IMPORTE']
dgc['MANO DE OBRA']=manob['IMPORTE']
dgc['GASTOS OPERATIVOS']=gope['IMPORTE']
dgc = dgc.fillna(0)
dgc['2022']=dgc['OTROS']+dgc['GASTOS FINANCIEROS']+dgc['GASTOS ADMIN.']+dgc['GASTOS VENTAS']+dgc['MANO DE OBRA']+dgc['GASTOS OPERATIVOS']
dgc=dgc.drop(['OTROS', 'GASTOS FINANCIEROS', 'GASTOS ADMIN.', 'GASTOS VENTAS',
       'MANO DE OBRA', 'GASTOS OPERATIVOS'], axis=1)

gastos_23=gastos_23.rename(columns={'Importe':'IMPORTE'})
dg=gastos_22[['FECHA','TIPO GASTO','IMPORTE']]
dg['MES']=dg['FECHA'].dt.month
dg['GASTO']=dg['TIPO GASTO']
dg['GASTO']=np.where(dg['GASTO']=='COMISION BANCARIA', 'GASTOS FINANCIEROS',
                     np.where(dg['GASTO']== 'PAPELERIA','GASTOS ADMINISTRATIVOS',
                              np.where(dg['GASTO']== 'CAPACITACION', 'GASTOS ADMINISTRATIVOS',
                                       np.where(dg['GASTO'] == 'ARRENDAMIENTO FINANCIERO', 'GASTOS FINANCIEROS',
                                                np.where(dg['GASTO']== 'CALIBRACIONES', 'GASTO DE VENTAS',
                                                         np.where(dg['GASTO'] == 'COMBUSTIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                  np.where(dg['GASTO']== 'COMBUSTIBLE','GASTO DE VENTAS',
                                                                           np.where(dg['GASTO']==  'COMISION VENTA', 'GASTO DE VENTAS',
                                                                                  np.where(dg['GASTO'] == 'COMPRAS', 'OTROS',
                                                                                           np.where(dg['GASTO']== 'DERECHOS', 'OTROS',
                                                                                                    np.where(dg['GASTO']== 'ENERGIA ELECTRICA', 'GASTOS ADMINISTRATIVOS',
                                                                                                             np.where(dg['GASTO']== 'GERENCIA VTAS', 'GASTO DE VENTAS',
                                                                                                                      np.where(dg['GASTO']== 'HONORARIOS ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                               np.where(dg['GASTO']== 'HONORARIOS CONTABLES', 'OTROS',
                                                                                                                                        np.where(dg['GASTO']== 'HOSPEDAJE', 'OTROS', 
                                                                                                                                                 np.where(dg['GASTO']== 'IMSS/INFONAVIT', 'OTROS',
                                                                                                                                                          np.where(dg['GASTO']== 'MAQUILAS GIC', 'OTROS',
                                                                                                                                                                   np.where(dg['GASTO']== 'MAQUINARIA', 'OTROS',
                                                                                                                                                                            np.where(dg['GASTO']== 'MTTO COMPUTO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                     np.where(dg['GASTO']== 'MTTO LOCAL', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                              np.where(dg['GASTO']== 'NO DEDUCIBLE', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                       np.where(dg['GASTO'] == 'PAPELERIA', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                np.where(dg['GASTO'] == 'PAQUETERIA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                         np.where(dg['GASTO'] == 'PEAJES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                  np.where(dg['GASTO'] == 'REPARACIONES ELECTRICAS', 'OTROS',
                                                                                                                                                                                                                                           np.where(dg['GASTO'] == 'SEGUROS', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                    np.where(dg['GASTO'] == 'TELEFONO', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                             np.where(dg['GASTO'] == 'TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                      np.where(dg['GASTO'] == 'UNIFORME', 'GASTOS OPERATIVOS',
                                                                                                                                                                                                                                                                               np.where(dg['GASTO'] == 'VALES DESPENSA', 'MANO DE OBRA',
                                                                                                                                                                                                                                                                                        np.where(dg['GASTO'] == 'ALIMENTOS', 'OTROS',
                                                                                                                                                                                                                                                                                                 np.where(dg['GASTO'] == 'ARRENDAMIENTO LOCAL', 'OTROS',
                                                                                                                                                                                                                                                                                                          np.where(dg['GASTO'] == 'GERENCIA ADMON', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                   np.where(dg['GASTO'] == 'MOBILIARIO', 'GASTOS OPERATIVOS', 
                                                                                                                                                                                                                                                                                                                            np.where(dg['GASTO'] == 'SUSCRIPCIONES', 'OTROS',
                                                                                                                                                                                                                                                                                                                                     np.where(dg['GASTO'] == 'MTTO TRANSPORTE', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                              np.where(dg['GASTO'] == 'SUBCONTRATOS', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                       np.where(dg['GASTO'] == 'MEDICOS', 'OTROS',
                                                                                                                                                                                                                                                                                                                                                                np.where(dg['GASTO'] == 'PUBLICIDAD', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                         np.where(dg['GASTO'] == 'FLETES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                  np.where(dg['GASTO'] == 'HONORARIOS PM', 'GASTOS ADMINISTRATIVOS',
                                                                                                                                                                                                                                                                                                                                                                                           np.where(dg['GASTO'] == 'MENSAJERIA', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                    np.where(dg['GASTO'] == 'ATENCION CLIENTES', 'GASTO DE VENTAS',
                                                                                                                                                                                                                                                                                                                                                                                                             np.where(dg['GASTO'] == 'SERV FUNERARIO ', 'OTROS', 'OTROS'
                                                                                                                                                                                                                                                                                                                                                                                                                                        ))))))))))))))))))))))))))))))))))))))))))))
otros=pd.DataFrame()
gfin=pd.DataFrame()
gadmin=pd.DataFrame()
gvnt=pd.DataFrame()
manob=pd.DataFrame()
gope=pd.DataFrame()
otros_=dg[dg['GASTO']=='OTROS']
otros['IMPORTE']=otros_.groupby('MES')['IMPORTE'].sum()
gfin_=dg[dg['GASTO']=='GASTOS FINANCIEROS']
gfin['IMPORTE']=gfin_.groupby('MES')['IMPORTE'].sum()
gadmin_=dg[dg['GASTO']=='GASTOS ADMINISTRATIVOS']
gadmin['IMPORTE']=gadmin_.groupby('MES')['IMPORTE'].sum()
gvnt_=dg[dg['GASTO']=='GASTO DE VENTAS']
gvnt['IMPORTE']=gvnt_.groupby('MES')['IMPORTE'].sum()
manob_=dg[dg['GASTO']=='MANO DE OBRA']
manob['IMPORTE']=manob_.groupby('MES')['IMPORTE'].sum()
gope_=dg[dg['GASTO']=='GASTOS OPERATIVOS']
gope['IMPORTE']=gope_.groupby('MES')['IMPORTE'].sum()
otros= otros.reset_index()
gfin = gfin.reset_index()
gadmin= gadmin.reset_index()
gvnt = gvnt.reset_index()
manob= manob.reset_index()
gope = gope.reset_index()
dgc['MES']=otros['MES']
dgc['OTROS']=otros['IMPORTE']
dgc['GASTOS FINANCIEROS']=gfin['IMPORTE']
dgc['GASTOS ADMIN.']=gadmin['IMPORTE']
dgc['GASTOS VENTAS']=gvnt['IMPORTE']
dgc['MANO DE OBRA']=manob['IMPORTE']
dgc['GASTOS OPERATIVOS']=gope['IMPORTE']
dgc = dgc.fillna(0)
dgc['2023']=dgc['OTROS']+dgc['GASTOS FINANCIEROS']+dgc['GASTOS ADMIN.']+dgc['GASTOS VENTAS']+dgc['MANO DE OBRA']+dgc['GASTOS OPERATIVOS']
dgc=dgc.drop(['OTROS', 'GASTOS FINANCIEROS', 'GASTOS ADMIN.', 'GASTOS VENTAS',
       'MANO DE OBRA', 'GASTOS OPERATIVOS'], axis=1)

d=dgc
dgc['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))


dgc['2023'] = dgc['2023'].replace(0, np.nan)
melted_data = pd.melt(dgc, id_vars=['Mes'], value_vars=['2020','2021','2022','2023'], var_name='Año', value_name='Importe')
clic=alt.selection_multi(encodings=['color'])
gpm_20 = alt.Chart(melted_data).mark_line(size=1.4,point=True).encode(
    x=alt.X('Mes',title='MES',axis=alt.Axis(labelAngle=0),sort=['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul',
       'Agto', 'Sep', 'Oct', 'Nov', 'Dic']), 
    y='Importe', 
    color=alt.Color('Año', scale=alt.Scale(domain=['2020','2021','2022','2023'], range=coloraños)),
    tooltip=['Año', 'Importe']
).properties(height=450,title='Gastos y Costos por Año').interactive().add_selection(clic)



if año != '':
    range_=[]
    if año == 2022:
      range_ =['#F37600','#FCA941', '#E16702','#C25E00']
    elif año == 2023:
      range_ =['#BA1424','#8A0E14', '#CB4C46','#E09490']
    elif año == 2021:
      range_ =['#005187','#6CB6F4', '#A7D3F8','#4589C4']
    elif año == 2020:
      range_ =['#7A5C3C','#BA9C7E', '#ECCBAB','#643c23']
    else:
      pass
    
    val = año % 100
    df='prueba'+str(val)
    gastoss=eval(df)
    clic=alt.selection_multi(encodings=['color'])

    graf8=alt.Chart(gastoss).mark_bar().encode(
        x=alt.X('GASTO', title= 'GASTO', axis=alt.Axis(labelAngle=90), sort=alt.EncodingSortField(field="IMPORTE TOTAL",order='descending')),
            y=alt.Y('IMPORTE TOTAL', title= 'Importe Total'),
        color = alt.condition(clic, 'GASTO', alt.value('#ffe7e7')),
    ).properties(height=300,width=300,title='Gastos y Costos %i'%año
    ).add_selection(
        clic
    )

    graf9=alt.Chart(gastoss).mark_bar().encode(
        x=alt.X('TIPO GASTO', sort=alt.EncodingSortField(field="IMPORTE TOTAL", order='descending')),
        y='IMPORTE TOTAL',
        color=alt.Color('GASTO', scale=alt.Scale(range=range_)),
        tooltip=['TIPO GASTO','GASTO','IMPORTE TOTAL']
    ).properties(title='Desglose de Gastos y Costos %i'%año
    ).transform_filter(    
        clic
    )

    graf_gast = graf8|graf9

prom_gas=melted_data['Importe'].mean()
prom_gas=round(prom_gas,2)
b1, b2 = st.columns(2)
with b1:
    b1.metric(label="Gasto y Costo Promedio", value='$%i' % prom_gas)
   #b1.markdown(('<div style="{}">Ingreso Promedio:<br>       $%f</div>'% prom_ing).format(square_style), unsafe_allow_html=True) #<br>
#with b2: 
#    b2.metric(label="Monto Adeudado", value='$%f' %vencido_m1)


col1, col2= st.columns(2)
with col1:
    #st.markdown('Rentabilidad por año')
    st.altair_chart(gpm_20,use_container_width=True)
with col2:
    st.altair_chart(graf_gast,use_container_width=True)       
         
#st.header('Proveedores y Vendedores')
colored_header(
    label="Proveedores y Vendedores",
    description='',
    color_name="red-70",)

if año != '':
    
    val = año % 100
    df='df_compras'+str(val)
    gastoss1=eval(df)
    clic=alt.selection_multi(encodings=['color'])

    graf_proov = alt.Chart(gastoss1).mark_bar(
        ).encode(
            x=alt.X("PROVEEDOR", title="PROOVEDOR",sort=alt.EncodingSortField(field="TOTAL MX", order='descending'), axis=alt.Axis(titleColor="black", labelAngle=90)),
            y=alt.Y("TOTAL MX", title="TOTAL MX", axis=alt.Axis(titleColor="black")),
            color=alt.Color('PROVEEDOR', scale=alt.Scale(range=range_)),
            tooltip=['PROVEEDOR','TOTAL MX']
        ).properties(height=600,
            title="Compras por proovedor %i"%año
        ).add_selection(clic).configure_legend(disable=True)


ven = pd.DataFrame()
ven['Ventas']=productos.groupby('NOMBRE_VENDEDOR')['SUBTOTAL_PARTIDA'].sum()
ven = ven.reset_index()
ven=ven.rename(columns={'NOMBRE_VENDEDOR':'Vendedor'})

vents=pd.DataFrame()
vents['Ventas']=productos.groupby(['MES','NOMBRE_VENDEDOR'])['SUBTOTAL_PARTIDA'].sum()
vents = vents.reset_index()
vents=vents.rename(columns={'NOMBRE_VENDEDOR':'Vendedor'})

d=vents
vents['Mes']=np.where(d['MES']==1,'Ene',
                     np.where(d['MES']==2,'Feb',
                              np.where(d['MES']==3,'Mar',
                                       np.where(d['MES']==4,'Abr',
                                                np.where(d['MES']==5,'May',
                                                         np.where(d['MES']==6,'Jun',
                                                                  np.where(d['MES']==7,'Jul',
                                                                           np.where(d['MES']==8,'Agto',
                                                                                    np.where(d['MES']==9,'Sep',
                                                                                             np.where(d['MES']==10,'Oct',
                                                                                                      np.where(d['MES']==11,'Nov','Dic')))))))))))

click=alt.selection_multi(encodings=['color'])
graf_ven= alt.Chart(ven).mark_arc(innerRadius=80).encode(
    theta=alt.Theta(field="Ventas",type="quantitative"), #Atributo a mostrar
    color=alt.condition(click,'Vendedor',alt.value('#ffe7e7')),#Atributo por el cual se separan los datos
    tooltip=['Vendedor','Ventas']
).properties(
    title="Ventas por Vendedor").add_selection(click).mark_arc(stroke='white', strokeWidth=2,innerRadius=80)

vendedores = alt.Chart(vents).mark_line(size=1.8,point=True).encode(
    x=alt.X('Mes',title='MES',axis=alt.Axis(labelAngle=0),sort=['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul',
       'Agto', 'Sep', 'Oct', 'Nov', 'Dic']),
    y='Ventas',  # Columna para los valores de las líneas
    color=alt.Color('Vendedor', scale=alt.Scale(range=Calor)),
    #tooltip=['Cuenta', 'Cantidad']
).properties(width=600,title='Desglose de Ventas por Vendedor').interactive().transform_filter(click) 


graf_vendedores= graf_ven|vendedores

pro_max=pd.DataFrame()
pro_max['Compras']=gastoss1.groupby('PROVEEDOR')['TOTAL MX'].sum()
pro_max=pro_max.reset_index()
pro_max=pro_max.sort_values('Compras', ascending=False)
mtr_max=pro_max.head(1)
mtr_max=mtr_max.iloc[0,0]
mtr_max=mtr_max.title()

mtr_ven=pd.DataFrame()
mtr_ven['Ventas']=vents.groupby('Vendedor')['Ventas'].sum()
mtr_ven=mtr_ven.reset_index()
mtr_ven=mtr_ven.sort_values('Ventas', ascending=False)
mtr_ven=mtr_ven.head(1)
mtr_ven=mtr_ven.iloc[0,0]
mtr_ven=mtr_ven.title()


b1, b2 = st.columns(2)
with b1:
    #b1.markdown(('<div style="{}">Principal Proveedor %i<br>%s</div>'% (año,mtr_max)).format(square_style), unsafe_allow_html=True) #<br>
    b1.metric(label="Principal Proveedor en %i" % año, value= mtr_max)
with b2:
    b2.metric(label="Mejor Vendedor" , value= mtr_ven)
    
col1, col2= st.columns(2)
with col1:
    #st.markdown('Rentabilidad por año')
    st.altair_chart(graf_proov,theme="streamlit",use_container_width=True)       
with col2:
    st.altair_chart(graf_vendedores,theme="streamlit",use_container_width=True)
         

if año != '':
    fact=facturacion3[facturacion3["AÑO"] == año]
    dev=devoluciones2[devoluciones2["AÑO"] == año]
    notas=notas_credito2[notas_credito2["AÑO"] == año]

    clic=alt.selection_multi(encodings=['color'])

    graf10=alt.Chart(fact).mark_bar().encode(
        y=alt.Y('count()', title= 'CONTEO'),
        x=alt.X('STATUS', sort=alt.EncodingSortField(order='descending')),
        color = alt.condition(clic, 'STATUS', alt.value('#ffe7e7')),
    ).properties(height=300,width=300,title='Status de Facturación %i' %año
    ).add_selection(
        clic
    )


    graf11=alt.Chart(fact).mark_bar().encode(
        x=alt.X('NOMBRE', sort=alt.EncodingSortField(field="CANTD_TOT", order='descending')),
        y='CANTD_TOT',
        color=alt.Color('STATUS', scale=alt.Scale(range=range_))
    ).properties(width=300,title='CANTIDAD TOTAL  %i' %año
    ).transform_filter(    
        clic
    )

    graf_statfact=graf10|graf11
    
    
    clic=alt.selection_multi(encodings=['color'])

    graf12=alt.Chart(notas).mark_bar().encode(
        y=alt.Y('count()', title= 'CONTEO'),
        x=alt.X('STATUS', sort=alt.EncodingSortField(field="count()",order='descending')),
        color = alt.condition(clic, 'STATUS', alt.value('#ffe7e7')),
    ).properties(height=300,width=300,title='Status Notas de Crédito %i' %año).add_selection(clic)

    graf13=alt.Chart(notas).mark_bar().encode(
        x=alt.X('NOMBRE', sort=alt.EncodingSortField(field="CANTD_TOT", order='descending')),
        y='CANTD_TOT',
        color=alt.Color('STATUS', scale=alt.Scale(range=range_))
    ).properties(width=300,title='Notas de Credito %i' %año).transform_filter(clic)

    graf_statnot= graf12|graf13
    
    clic=alt.selection_multi(encodings=['color'])

    graf14=alt.Chart(dev).mark_bar().encode(
        y=alt.Y('count()', title= 'CONTEO'),
        x=alt.X('STATUS', sort=alt.EncodingSortField(field="count()",order='descending')),
        color = alt.condition(clic, 'STATUS', alt.value('#ffe7e7')),
    ).properties(height=300,width=300,title='Status Devoluciones%i' %año).add_selection(clic)

    graf15=alt.Chart(dev).mark_bar(
    ).encode(
        x=alt.X('NOMBRE', sort=alt.EncodingSortField(field="CANTD_TOT", order='descending')),
        y='CANTD_TOT',
        color=alt.Color('STATUS', scale=alt.Scale(range=range_))
    ).properties(width=300,title='Devoluciones %i' %año).transform_filter(clic)


    graf_statdev=graf14|graf15
    
else:
    pass


colored_header(
    label="Status de Notas de Crédito y Devoluciones",
    description='',
    color_name="red-70",)

#st.header('Status de Facturas, Notas de Crédito y Devoluciones')

col1, col2, col3,col4= st.columns(4)
#with col2:
    #st.altair_chart(graf_statdev,theme="streamlit",use_container_width=True)
with col1:
    stoggle(
    "Descripción Status",
    """🔸E: Emitida <br> 🔸C: Cancelada""")
    
col1, col2= st.columns(2)
with col1:
    st.altair_chart(graf_statnot,theme="streamlit",use_container_width=True)       
with col2:
    st.altair_chart(graf_statdev,theme="streamlit",use_container_width=True)

#col1, col2, col3,col4= st.columns(4)
#with col2:
 #   st.altair_chart(graf_statfact,theme="streamlit",use_container_width=True)




       
         
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              